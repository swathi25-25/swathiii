<script>
let timer;
let timeLeft = 45;
let score = 0;
let totalAsked = 0;
let usedQuestions = [];
let currentQuestion = "";
let disqualified = false;

/* üîé Keywords added for relevance checking */
const questionBank = {
"Software Engineer": [
{q:"Explain OOPS principles.", keywords:["encapsulation","inheritance","polymorphism","abstraction","class","object"]},
{q:"What is REST API?", keywords:["api","http","client","server","stateless","request","response"]},
{q:"Tell me about yourself.", keywords:["experience","skills","education","background"]},
{q:"How do you handle deadlines?", keywords:["time","management","priority","planning"]},
{q:"What is multithreading?", keywords:["thread","parallel","concurrent","process"]},
{q:"Describe a challenging project.", keywords:["project","challenge","solution"]},
{q:"What is database normalization?", keywords:["normalization","database","redundancy","table"]},
{q:"Why should we hire you?", keywords:["skills","experience","contribution","value"]}
],

"Data Scientist": [
{q:"What is overfitting?", keywords:["model","training","test","variance","error"]},
{q:"Explain bias vs variance.", keywords:["bias","variance","overfitting","underfitting"]},
{q:"How do you communicate insights?", keywords:["data","visualization","report","stakeholder"]},
{q:"Describe your ML project.", keywords:["model","data","algorithm","result"]},
{q:"What is feature engineering?", keywords:["feature","data","selection","transformation"]},
{q:"Why Data Science?", keywords:["data","analysis","insight"]},
{q:"Explain cross validation.", keywords:["validation","fold","model","training"]},
{q:"How do you handle pressure?", keywords:["time","management","priority"]}
],

"Cloud Engineer": [
{q:"What is cloud computing?", keywords:["cloud","internet","server","service"]},
{q:"Explain IaaS, PaaS, SaaS.", keywords:["iaas","paas","saas","service"]},
{q:"Why cloud career?", keywords:["cloud","technology","growth"]},
{q:"What is load balancing?", keywords:["traffic","server","distribution"]},
{q:"Describe a cloud project.", keywords:["cloud","deployment","service"]},
{q:"How do you ensure security?", keywords:["security","encryption","access"]},
{q:"What is containerization?", keywords:["container","docker","application"]},
{q:"How do you manage failures?", keywords:["backup","recovery","monitoring"]}
],

"Cyber Security Analyst": [
{q:"What is phishing?", keywords:["email","fraud","attack","user"]},
{q:"Explain encryption.", keywords:["encryption","data","security","key"]},
{q:"Describe a security breach response.", keywords:["incident","response","attack"]},
{q:"Why cyber security?", keywords:["security","protection","data"]},
{q:"What is firewall?", keywords:["firewall","network","security"]},
{q:"What is penetration testing?", keywords:["testing","security","vulnerability"]},
{q:"How do you handle threats?", keywords:["monitoring","risk","analysis"]},
{q:"What is vulnerability assessment?", keywords:["vulnerability","scan","security"]}
],

"HR Manager": [
{q:"Explain recruitment lifecycle.", keywords:["recruitment","hiring","interview"]},
{q:"How do you resolve conflicts?", keywords:["conflict","communication","resolution"]},
{q:"Why HR field?", keywords:["hr","people","management"]},
{q:"What is employee engagement?", keywords:["employee","motivation","engagement"]},
{q:"Describe leadership experience.", keywords:["leadership","team","management"]},
{q:"What is payroll management?", keywords:["salary","payroll","compensation"]},
{q:"How do you handle stress?", keywords:["stress","management","calm"]},
{q:"Explain performance appraisal.", keywords:["performance","evaluation","review"]}
],

"Business Analyst": [
{q:"What is requirement gathering?", keywords:["requirement","stakeholder","analysis"]},
{q:"Explain SWOT analysis.", keywords:["strength","weakness","opportunity","threat"]},
{q:"Why BA role?", keywords:["analysis","business","stakeholder"]},
{q:"What is BRD?", keywords:["document","requirement","business"]},
{q:"Describe stakeholder management.", keywords:["stakeholder","communication","management"]},
{q:"What is gap analysis?", keywords:["gap","current","future"]},
{q:"How do you prioritize tasks?", keywords:["priority","planning","task"]},
{q:"Explain Agile methodology.", keywords:["agile","sprint","scrum"]}
],

"AI/ML Engineer": [
{q:"What is gradient descent?", keywords:["gradient","optimization","loss"]},
{q:"Explain neural networks.", keywords:["neuron","layer","activation"]},
{q:"Why AI career?", keywords:["ai","technology","learning"]},
{q:"What is deep learning?", keywords:["deep","neural","model"]},
{q:"Explain your AI project.", keywords:["model","data","result"]},
{q:"Difference between CNN and RNN?", keywords:["cnn","rnn","network"]},
{q:"What is model deployment?", keywords:["deployment","production","model"]},
{q:"How do you update skills?", keywords:["learning","technology","course"]}
],

"Digital Marketing Manager": [
{q:"What is SEO?", keywords:["seo","search","ranking"]},
{q:"Explain digital marketing funnel.", keywords:["awareness","conversion","funnel"]},
{q:"How do you measure campaign success?", keywords:["kpi","analytics","roi"]},
{q:"What is PPC?", keywords:["ppc","ads","click"]},
{q:"Why marketing career?", keywords:["marketing","brand","growth"]},
{q:"What is conversion rate?", keywords:["conversion","percentage","sales"]},
{q:"Explain content strategy.", keywords:["content","strategy","audience"]},
{q:"Describe a marketing campaign.", keywords:["campaign","marketing","result"]}
]
};

function startInterview(){

if(disqualified){
alert("You are DISQUALIFIED. Refresh page to restart.");
return;
}

let role = document.getElementById("roleSelect").value;
let questions = questionBank[role];
let available = questions.filter(q=>!usedQuestions.includes(q.q));

if(available.length===0){
document.getElementById("questionBox").innerHTML="Interview Completed!";
return;
}

let randomIndex=Math.floor(Math.random()*available.length);
currentQuestion=available[randomIndex];
usedQuestions.push(currentQuestion.q);
totalAsked++;

document.getElementById("questionBox").innerHTML="<b>Question:</b> "+currentQuestion.q;
document.getElementById("resultBox").innerHTML="";
document.getElementById("answerBox").value="";
startTimer();
}

function startTimer(){
clearInterval(timer);
timeLeft=45;
updateTimer();
timer=setInterval(()=>{
timeLeft--;
updateTimer();
if(timeLeft<=0){
clearInterval(timer);
evaluateAnswer();
}
},1000);
}

function updateTimer(){
document.getElementById("timer").innerHTML="Time: "+timeLeft+"s";
}

function submitAnswer(){
clearInterval(timer);
evaluateAnswer();
}

function evaluateAnswer(){

if(disqualified) return;

let answer=document.getElementById("answerBox").value.trim().toLowerCase();
let result=document.getElementById("resultBox");

if(answer.length<20){
result.style.background="#8B0000";
result.innerHTML="Answer too short. Improve your explanation.";
return;
}

/* üîé Relevance Check */
let matchCount=0;
currentQuestion.keywords.forEach(keyword=>{
if(answer.includes(keyword)){
matchCount++;
}
});

/* ‚ùå If No Match ‚Üí DISQUALIFIED */
if(matchCount===0){
disqualified=true;
result.style.background="#8B0000";
result.innerHTML="<b>DISQUALIFIED ‚ùå</b><br>Your answer is not relevant to the question.";
document.getElementById("scoreBoard").innerHTML="Status: Disqualified";
clearInterval(timer);
return;
}

/* ‚úÖ Original Grading System */
let grade,feedback,points;

if(answer.length>180){
grade="A+";
feedback="Outstanding detailed professional answer.";
points=10;
}
else if(answer.length>120){
grade="A";
feedback="Strong answer with clarity and depth.";
points=8;
}
else if(answer.length>70){
grade="B";
feedback="Good answer but add more technical depth.";
points=6;
}
else{
grade="C";
feedback="Basic response. Needs improvement.";
points=4;
}

score+=points;

result.style.background="#004d40";
result.innerHTML="<b>Grade:</b> "+grade+"<br><b>Feedback:</b> "+feedback;

document.getElementById("scoreBoard").innerHTML=
"Score: "+score+" | Questions Attempted: "+totalAsked;

document.getElementById("progress").style.width=
(totalAsked*12)+"%";
}
</script>
